import{M}from"./index-f5b80f59.js";import{a7 as $,G as I,ac as b,o,g as a,h as r,a8 as w,t as f,m as C,k as m,w as u,j as N,l as T,X as A,i as V,a9 as L,Z as x,$ as E,ad as R,aa as S,ab as B}from"./index-cb34a449.js";import{t as F,r as g,v as H,e as q,w as U,x as j,y as D}from"./PostAPI-dc9890c8.js";import{a as O,E as G}from"./el-form-item-e2bf10d3.js";import{E as X}from"./el-button-7ff423d0.js";import"./index-42f7244d.js";const Z={class:"comment-div"},z={class:"comment-div-h2"},J={key:0},K={__name:"Comment",props:{msg:Object},setup(d){const s=d,e=I({name:"",email:"",comment:""}),i=I(!1),c=async()=>{if(e.value.name===""||e.value.email===""||e.value.comment===""){g({title:"发表评论失败",type:"error",message:"请填写完整信息"});return}H(s.msg.articleId,e.value.name,e.value.email,s.msg.parentId,e.value.comment,b(),t=>{g({title:"发表成功",type:"success",message:t.message}),window.location.reload()},t=>{g({title:"发表评论失败",type:"error",message:t})})};(b()!=null||b()!="")&&F(b(),t=>{e.value.email=t.data.email,e.value.name=t.data.userName,i.value=!0},t=>{});const l=[{required:!0,message:"邮箱不能为空",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],p=[{required:!0,message:"评论不能为空",trigger:"blur"}],k=[{required:!0,message:"昵称不能为空",trigger:"blur"}];return(t,n)=>{const _=q,v=O,h=X,P=G;return o(),a("div",Z,[r("h2",z,[w("评论 "),s.msg.parentId!=null&&s.msg.parentId!=""?(o(),a("span",J," @"+f(s.msg.parentId),1)):C("",!0)]),m(P,{model:e.value,"label-position":t.left,ref:"commentForm",onSubmit:T(c,["prevent"]),class:"comment-form"},{default:u(()=>[m(v,{label:"昵称：",class:"comment-form-item",prop:"name",rules:k},{default:u(()=>[m(_,{modelValue:e.value.name,"onUpdate:modelValue":n[0]||(n[0]=y=>e.value.name=y),class:"comment-form-item",disabled:i.value},null,8,["modelValue","disabled"])]),_:1}),m(v,{label:"邮箱：",class:"comment-form-item",prop:"email",rules:l},{default:u(()=>[m(_,{modelValue:e.value.email,"onUpdate:modelValue":n[1]||(n[1]=y=>e.value.email=y),class:"comment-form-item",disabled:i.value},null,8,["modelValue","disabled"])]),_:1}),m(v,{label:"评论：",class:"comment-form-item",prop:"comment",rules:p},{default:u(()=>[m(_,{type:"textarea",modelValue:e.value.comment,"onUpdate:modelValue":n[2]||(n[2]=y=>e.value.comment=y),class:"comment-form-item comment-form-textarea"},null,8,["modelValue"])]),_:1}),m(v,{class:"comment-form-item"},{default:u(()=>[m(h,{type:"primary",onClick:c,class:"comment-form-primary"},{default:u(()=>[w("发送评论 ")]),_:1})]),_:1}),s.msg.parentId!=null&&s.msg.parentId!=""?(o(),N(v,{key:0,class:"comment-form-item"},{default:u(()=>[m(h,{type:"danger",onClick:n[3]||(n[3]=y=>s.msg.parentId=null),class:"comment-form-cancel"},{default:u(()=>[w(" 取消回复 ")]),_:1})]),_:1})):C("",!0)]),_:1},8,["model","label-position","onSubmit"])])}}},Q=$(K,[["__scopeId","data-v-1317f22f"]]);const W={class:"comment"},Y={class:"comentIten-userName"},ee={class:"comentIten-content"},te={key:0,class:"replies"},oe={__name:"CommentItem",props:{comment:Object},emits:["response"],setup(d,{emit:s}){const e=d,i=async()=>{confirm("确定删除该评论吗？")&&U(e.comment.id,b(),l=>{g({title:"删除成功",type:"success",message:l.message}),window.location.reload()},l=>{g({title:"删除失败",type:"error",message:l})})},c=async()=>{window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"}),s("response",e.comment.id)};return(l,p)=>{const k=A("CommentItem",!0);return o(),a("div",null,[r("div",W,[r("h5",Y,f(e.comment.userName)+" /@"+f(e.comment.id),1),r("h5",{class:"comentIten-reply",onClick:c},"回复"),r("p",ee,f(e.comment.content),1),V(b)()!=null?(o(),a("h5",{key:0,class:"comentIten-delete",onClick:i},"删除")):C("",!0),r("small",null,f(V(L)(e.comment.createdAt)),1)]),e.comment.comments.length>0?(o(),a("div",te,[(o(!0),a(x,null,E(e.comment.comments,(t,n)=>(o(),N(k,{onResponse:p[0]||(p[0]=_=>{e.comment.id=_,s("response",e.comment.id)}),key:n,comment:t},null,8,["comment"]))),128))])):C("",!0)])}}},se=$(oe,[["__scopeId","data-v-75d40270"]]);const ne=d=>(S("data-v-c36d7449"),d=d(),B(),d),me={key:0,class:"article-content"},ae=["innerHTML"],le={key:1,class:"article-content"},re=["innerHTML"],ce={key:2},ie=ne(()=>r("h2",null,"评论",-1)),de={class:"article-contents"},ue={__name:"ArticlePage",props:{},emits:["response"],setup(d,{emit:s}){s("response","文章");const e=R(),i=I(e.params.id),c=I({}),l=I(),p=I({articleId:i.value,parentId:""}),k=new M;return j(i.value,t=>{c.value=t.data},t=>{g({title:"获取文章失败",type:"error",message:t})}),D(i.value,t=>{l.value=t.data},t=>{g({title:"获取评论失败",type:"error",message:t})}),(t,n)=>(o(),a(x,null,[w(" / "+f(V(e).params.id)+" ",1),r("h1",null,f(c.value.title),1),c.value.markdownContent==""?(o(),a("div",me,[r("div",{innerHTML:c.value.content,class:"markdown-body"},null,8,ae)])):(o(),a("div",le,[r("div",{innerHTML:V(k).render(c.value.markdownContent??""),class:"markdown-body"},null,8,re)])),l.value&&l.value.comments?(o(),a("div",ce,[ie,r("div",de,[(o(!0),a(x,null,E(l.value.comments,(_,v)=>(o(),a("div",{key:v,class:"article-contents-item"},[m(se,{comment:_,onResponse:n[0]||(n[0]=h=>p.value.parentId=h)},null,8,["comment"])]))),128))])])):C("",!0),m(Q,{msg:p.value},null,8,["msg"])],64))}},Ie=$(ue,[["__scopeId","data-v-c36d7449"]]);export{Ie as default};
