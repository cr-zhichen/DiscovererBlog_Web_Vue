import{E as A,a as B,m as P}from"./markdown-css-86c4eb08.js";import{ag as E,A as h,an as I,o as t,e as m,x as a,ai as x,t as d,a1 as k,Y as c,w as _,f as $,z as M,W as L,u as w,aj as R,$ as V,a0 as N,ao as S,X as q,q as F,al as H,am as D}from"./index-4159d20a.js";import{e as U,d as b,p as j,b as O,f as W,h as z,v as X}from"./PostAPI-f174cb36.js";import{a as Y,E as G}from"./el-form-item-a390249e.js";import{E as J}from"./el-button-f227261b.js";import"./focus-trap-f84491e0.js";import"./scroll-0eb5bfb3.js";import"./index-1179f78b.js";const K={class:"comment-div"},Q={class:"comment-div-h2"},Z={key:0},ee={__name:"Comment",props:{msg:Object},setup(p){const s=p,e=h({name:"",email:"",comment:""}),u=h(!1),n=async()=>{if(e.value.name===""||e.value.email===""||e.value.comment===""){b({title:"发表评论失败",type:"error",message:"请填写完整信息"});return}j(s.msg.articleId,e.value.name,e.value.email,s.msg.parentId,e.value.comment,I(),o=>{b({title:"发表成功",type:"success",message:o.message}),window.location.reload()},o=>{b({title:"发表评论失败",type:"error",message:o})})};(I()!=null||I()!="")&&U(I(),o=>{e.value.email=o.data.email,e.value.name=o.data.userName,u.value=!0},o=>{});const i=[{required:!0,message:"邮箱不能为空",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],v=[{required:!0,message:"评论不能为空",trigger:"blur"}],l=[{required:!0,message:"昵称不能为空",trigger:"blur"}];return(o,r)=>{const g=O,f=Y,C=J,T=G;return t(),m("div",K,[a("h2",Q,[x("评论 "),s.msg.parentId!=null&&s.msg.parentId!=""?(t(),m("span",Z," @"+d(s.msg.parentId),1)):k("",!0)]),c(T,{model:e.value,"label-position":o.left,ref:"commentForm",onSubmit:M(n,["prevent"]),class:"comment-form"},{default:_(()=>[c(f,{label:"昵称：",class:"comment-form-item",prop:"name",rules:l},{default:_(()=>[c(g,{modelValue:e.value.name,"onUpdate:modelValue":r[0]||(r[0]=y=>e.value.name=y),class:"comment-form-item",disabled:u.value},null,8,["modelValue","disabled"])]),_:1}),c(f,{label:"邮箱：",class:"comment-form-item",prop:"email",rules:i},{default:_(()=>[c(g,{modelValue:e.value.email,"onUpdate:modelValue":r[1]||(r[1]=y=>e.value.email=y),class:"comment-form-item",disabled:u.value},null,8,["modelValue","disabled"])]),_:1}),c(f,{label:"评论：",class:"comment-form-item",prop:"comment",rules:v},{default:_(()=>[c(g,{type:"textarea",modelValue:e.value.comment,"onUpdate:modelValue":r[2]||(r[2]=y=>e.value.comment=y),class:"comment-form-item comment-form-textarea"},null,8,["modelValue"])]),_:1}),c(f,{class:"comment-form-item"},{default:_(()=>[c(C,{type:"primary",onClick:n,class:"comment-form-primary"},{default:_(()=>[x("发送评论 ")]),_:1})]),_:1}),s.msg.parentId!=null&&s.msg.parentId!=""?(t(),$(f,{key:0,class:"comment-form-item"},{default:_(()=>[c(C,{type:"danger",onClick:r[3]||(r[3]=y=>s.msg.parentId=null),class:"comment-form-cancel"},{default:_(()=>[x(" 取消回复 ")]),_:1})]),_:1})):k("",!0)]),_:1},8,["model","label-position","onSubmit"])])}}},te=E(ee,[["__scopeId","data-v-1317f22f"]]);const oe={class:"comment"},se={class:"comentIten-userName"},ne={class:"comentIten-content"},me={key:0,class:"replies"},ae={__name:"CommentItem",props:{comment:Object},emits:["response"],setup(p,{emit:s}){const e=p,u=async()=>{A.confirm("确定删除该评论吗？","Warning",{confirmButtonText:"确实",cancelButtonText:"取消",type:"warning"}).then(()=>{W(e.comment.id,I(),i=>{window.location.reload()},i=>{b({title:"删除失败",type:"error",message:i})})}).catch(()=>{B({type:"info",message:"已取消删除"})})},n=async()=>{window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"}),s("response",e.comment.id)};return(i,v)=>{const l=L("CommentItem",!0);return t(),m("div",null,[a("div",oe,[a("h5",se,d(e.comment.userName)+" /@"+d(e.comment.id),1),a("h5",{class:"comentIten-reply",onClick:n},"回复"),a("p",ne,d(e.comment.content),1),w(I)()!=null?(t(),m("h5",{key:0,class:"comentIten-delete",onClick:u},"删除")):k("",!0),a("small",null,d(w(R)(e.comment.createdAt)),1)]),e.comment.comments.length>0?(t(),m("div",me,[(t(!0),m(V,null,N(e.comment.comments,(o,r)=>(t(),$(l,{onResponse:v[0]||(v[0]=g=>{e.comment.id=g,s("response",e.comment.id)}),key:r,comment:o},null,8,["comment"]))),128))])):k("",!0)])}}},le=E(ae,[["__scopeId","data-v-3f334452"]]);const re=p=>(H("data-v-ee248cbd"),p=p(),D(),p),ce={key:0},ie={key:1,class:"article-content"},ue=["innerHTML"],de={key:2,class:"article-content"},pe=["innerHTML"],_e={key:3},ve=re(()=>a("h2",null,"评论",-1)),ge={class:"article-contents"},fe={__name:"ArticlePage",props:{},emits:["response"],setup(p,{emit:s}){s("response","文章");const e=S(),u=h(e.params.id),n=h({}),i=h(),v=h({articleId:u.value,parentId:""});return z(u.value,l=>{n.value=l.data},l=>{b({title:"获取文章失败",type:"error",message:l})}),X(u.value,l=>{i.value=l.data},l=>{b({title:"获取评论失败",type:"error",message:l})}),(l,o)=>{const r=q("highlight");return t(),m(V,null,[a("p",null," / "+d(w(e).params.id),1),n.value.tags!=""?(t(),m("p",ce,"文章分类："+d(n.value.tags),1)):k("",!0),a("p",null,"更新时间："+d(n.value.updatedAt),1),a("h1",null,d(n.value.title),1),n.value.markdownContent==""?(t(),m("div",ie,[a("div",{innerHTML:n.value.content,class:"markdown-body"},null,8,ue)])):(t(),m("div",de,[F(a("div",{innerHTML:w(P)(n.value.markdownContent??""),class:"markdown-body"},null,8,pe),[[r]])])),i.value&&i.value.comments?(t(),m("div",_e,[ve,a("div",ge,[(t(!0),m(V,null,N(i.value.comments,(g,f)=>(t(),m("div",{key:f,class:"article-contents-item"},[c(le,{comment:g,onResponse:o[0]||(o[0]=C=>v.value.parentId=C)},null,8,["comment"])]))),128))])])):k("",!0),c(te,{msg:v.value},null,8,["msg"])],64)}}},Ve=E(fe,[["__scopeId","data-v-ee248cbd"]]);export{Ve as default};
