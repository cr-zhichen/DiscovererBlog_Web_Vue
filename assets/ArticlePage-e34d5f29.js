import{E as T,a as A,M as B}from"./index-7af44eee.js";import{ag as E,A as y,al as I,o,e as a,x as l,ah as x,t as u,a1 as h,Y as r,w as p,f as $,z as P,W as L,u as w,ai as R,$ as V,a0 as M,am as S,aj as F,ak as H}from"./index-c9e2cc77.js";import{e as q,d as b,p as U,b as j,f as D,h as O,v as W}from"./PostAPI-dfc4f8d5.js";import{a as z,E as Y}from"./el-form-item-fe4af1ba.js";import{E as G}from"./el-button-65c75d97.js";import"./focus-trap-d6d374cc.js";import"./scroll-2c3d29a1.js";import"./index-63a79329.js";const J={class:"comment-div"},K={class:"comment-div-h2"},Q={key:0},X={__name:"Comment",props:{msg:Object},setup(d){const s=d,e=y({name:"",email:"",comment:""}),i=y(!1),n=async()=>{if(e.value.name===""||e.value.email===""||e.value.comment===""){b({title:"发表评论失败",type:"error",message:"请填写完整信息"});return}U(s.msg.articleId,e.value.name,e.value.email,s.msg.parentId,e.value.comment,I(),t=>{b({title:"发表成功",type:"success",message:t.message}),window.location.reload()},t=>{b({title:"发表评论失败",type:"error",message:t})})};(I()!=null||I()!="")&&q(I(),t=>{e.value.email=t.data.email,e.value.name=t.data.userName,i.value=!0},t=>{});const c=[{required:!0,message:"邮箱不能为空",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],_=[{required:!0,message:"评论不能为空",trigger:"blur"}],k=[{required:!0,message:"昵称不能为空",trigger:"blur"}];return(t,m)=>{const v=j,f=z,C=G,N=Y;return o(),a("div",J,[l("h2",K,[x("评论 "),s.msg.parentId!=null&&s.msg.parentId!=""?(o(),a("span",Q," @"+u(s.msg.parentId),1)):h("",!0)]),r(N,{model:e.value,"label-position":t.left,ref:"commentForm",onSubmit:P(n,["prevent"]),class:"comment-form"},{default:p(()=>[r(f,{label:"昵称：",class:"comment-form-item",prop:"name",rules:k},{default:p(()=>[r(v,{modelValue:e.value.name,"onUpdate:modelValue":m[0]||(m[0]=g=>e.value.name=g),class:"comment-form-item",disabled:i.value},null,8,["modelValue","disabled"])]),_:1}),r(f,{label:"邮箱：",class:"comment-form-item",prop:"email",rules:c},{default:p(()=>[r(v,{modelValue:e.value.email,"onUpdate:modelValue":m[1]||(m[1]=g=>e.value.email=g),class:"comment-form-item",disabled:i.value},null,8,["modelValue","disabled"])]),_:1}),r(f,{label:"评论：",class:"comment-form-item",prop:"comment",rules:_},{default:p(()=>[r(v,{type:"textarea",modelValue:e.value.comment,"onUpdate:modelValue":m[2]||(m[2]=g=>e.value.comment=g),class:"comment-form-item comment-form-textarea"},null,8,["modelValue"])]),_:1}),r(f,{class:"comment-form-item"},{default:p(()=>[r(C,{type:"primary",onClick:n,class:"comment-form-primary"},{default:p(()=>[x("发送评论 ")]),_:1})]),_:1}),s.msg.parentId!=null&&s.msg.parentId!=""?(o(),$(f,{key:0,class:"comment-form-item"},{default:p(()=>[r(C,{type:"danger",onClick:m[3]||(m[3]=g=>s.msg.parentId=null),class:"comment-form-cancel"},{default:p(()=>[x(" 取消回复 ")]),_:1})]),_:1})):h("",!0)]),_:1},8,["model","label-position","onSubmit"])])}}},Z=E(X,[["__scopeId","data-v-1317f22f"]]);const ee={class:"comment"},te={class:"comentIten-userName"},oe={class:"comentIten-content"},se={key:0,class:"replies"},ne={__name:"CommentItem",props:{comment:Object},emits:["response"],setup(d,{emit:s}){const e=d,i=async()=>{T.confirm("确定删除该评论吗？","Warning",{confirmButtonText:"确实",cancelButtonText:"取消",type:"warning"}).then(()=>{D(e.comment.id,I(),c=>{window.location.reload()},c=>{b({title:"删除失败",type:"error",message:c})})}).catch(()=>{A({type:"info",message:"已取消删除"})})},n=async()=>{window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"}),s("response",e.comment.id)};return(c,_)=>{const k=L("CommentItem",!0);return o(),a("div",null,[l("div",ee,[l("h5",te,u(e.comment.userName)+" /@"+u(e.comment.id),1),l("h5",{class:"comentIten-reply",onClick:n},"回复"),l("p",oe,u(e.comment.content),1),w(I)()!=null?(o(),a("h5",{key:0,class:"comentIten-delete",onClick:i},"删除")):h("",!0),l("small",null,u(w(R)(e.comment.createdAt)),1)]),e.comment.comments.length>0?(o(),a("div",se,[(o(!0),a(V,null,M(e.comment.comments,(t,m)=>(o(),$(k,{onResponse:_[0]||(_[0]=v=>{e.comment.id=v,s("response",e.comment.id)}),key:m,comment:t},null,8,["comment"]))),128))])):h("",!0)])}}},me=E(ne,[["__scopeId","data-v-3f334452"]]);const ae=d=>(F("data-v-8e07e868"),d=d(),H(),d),le={key:0},re={key:1,class:"article-content"},ce=["innerHTML"],ie={key:2,class:"article-content"},ue=["innerHTML"],de={key:3},pe=ae(()=>l("h2",null,"评论",-1)),_e={class:"article-contents"},ve={__name:"ArticlePage",props:{},emits:["response"],setup(d,{emit:s}){s("response","文章");const e=S(),i=y(e.params.id),n=y({}),c=y(),_=y({articleId:i.value,parentId:""}),k=new B;return O(i.value,t=>{n.value=t.data},t=>{b({title:"获取文章失败",type:"error",message:t})}),W(i.value,t=>{c.value=t.data},t=>{b({title:"获取评论失败",type:"error",message:t})}),(t,m)=>(o(),a(V,null,[l("p",null," / "+u(w(e).params.id),1),n.value.tags!=""?(o(),a("p",le,"文章分类："+u(n.value.tags),1)):h("",!0),l("p",null,"更新时间："+u(n.value.updatedAt),1),l("h1",null,u(n.value.title),1),n.value.markdownContent==""?(o(),a("div",re,[l("div",{innerHTML:n.value.content,class:"markdown-body"},null,8,ce)])):(o(),a("div",ie,[l("div",{innerHTML:w(k).render(n.value.markdownContent??""),class:"markdown-body"},null,8,ue)])),c.value&&c.value.comments?(o(),a("div",de,[pe,l("div",_e,[(o(!0),a(V,null,M(c.value.comments,(v,f)=>(o(),a("div",{key:f,class:"article-contents-item"},[r(me,{comment:v,onResponse:m[0]||(m[0]=C=>_.value.parentId=C)},null,8,["comment"])]))),128))])])):h("",!0),r(Z,{msg:_.value},null,8,["msg"])],64))}},we=E(ve,[["__scopeId","data-v-8e07e868"]]);export{we as default};
