import{ak as $,D as I,as as b,o as s,e as a,A as o,am as x,t as l,a5 as y,a1 as i,w as _,f as E,C as T,ao as B,$ as P,g as C,an as M,a3 as V,a4 as A,at as L,a0 as R,x as S,aq as q,ar as D}from"./index-69830f6f.js";import{c as F,b as k,p as H,a as U,d as j,e as O,f as W}from"./PostAPI-b7e13ed9.js";import{a as z,E as G}from"./el-form-item-f4ff319f.js";import{E as J,a as K,m as Q}from"./markdown-css-e11eb313.js";import"./_initCloneObject-80e9d896.js";import"./focus-trap-8a638bdb.js";import"./scroll-2e708b08.js";const X={class:"comment-div"},Y={class:"comment-div-h2"},Z={key:0},ee={__name:"Comment",props:{msg:Object},setup(p){const m=p,e=I({name:"",email:"",comment:""}),d=I(!1),t=async()=>{if(e.value.name===""||e.value.email===""||e.value.comment===""){k({title:"发表评论失败",type:"error",message:"请填写完整信息"});return}H(m.msg.articleId,e.value.name,e.value.email,m.msg.parentId,e.value.comment,b(),n=>{k({title:"发表成功",type:"success",message:n.message}),window.location.reload()},n=>{k({title:"发表评论失败",type:"error",message:n})})};(b()!=null||b()!="")&&F(b(),n=>{e.value.email=n.data.email,e.value.name=n.data.userName,d.value=!0},n=>{});const u=[{required:!0,message:"邮箱不能为空",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],v=[{required:!0,message:"评论不能为空",trigger:"blur"}],r=[{required:!0,message:"昵称不能为空",trigger:"blur"}];return(n,c)=>{const g=U,f=z,w=B,N=G;return s(),a("div",X,[o("h2",Y,[x("评论 "),m.msg.parentId!=null&&m.msg.parentId!=""?(s(),a("span",Z," @"+l(m.msg.parentId),1)):y("",!0)]),i(N,{model:e.value,"label-position":n.left,ref:"commentForm",onSubmit:T(t,["prevent"]),class:"comment-form"},{default:_(()=>[i(f,{label:"昵称：",class:"comment-form-item",prop:"name",rules:r},{default:_(()=>[i(g,{modelValue:e.value.name,"onUpdate:modelValue":c[0]||(c[0]=h=>e.value.name=h),class:"comment-form-item",disabled:d.value},null,8,["modelValue","disabled"])]),_:1}),i(f,{label:"邮箱：",class:"comment-form-item",prop:"email",rules:u},{default:_(()=>[i(g,{modelValue:e.value.email,"onUpdate:modelValue":c[1]||(c[1]=h=>e.value.email=h),class:"comment-form-item",disabled:d.value},null,8,["modelValue","disabled"])]),_:1}),i(f,{label:"评论：",class:"comment-form-item",prop:"comment",rules:v},{default:_(()=>[i(g,{type:"textarea",modelValue:e.value.comment,"onUpdate:modelValue":c[2]||(c[2]=h=>e.value.comment=h),class:"comment-form-item comment-form-textarea"},null,8,["modelValue"])]),_:1}),i(f,{class:"comment-form-item"},{default:_(()=>[i(w,{type:"primary",onClick:t,class:"comment-form-primary"},{default:_(()=>[x("发送评论 ")]),_:1})]),_:1}),m.msg.parentId!=null&&m.msg.parentId!=""?(s(),E(f,{key:0,class:"comment-form-item"},{default:_(()=>[i(w,{type:"danger",onClick:c[3]||(c[3]=h=>m.msg.parentId=null),class:"comment-form-cancel"},{default:_(()=>[x(" 取消回复 ")]),_:1})]),_:1})):y("",!0)]),_:1},8,["model","label-position","onSubmit"])])}}},te=$(ee,[["__scopeId","data-v-1317f22f"]]);const oe={class:"comment"},se={class:"comentIten-userName"},ne={class:"comentIten-content"},ae={key:0,class:"replies"},me={__name:"CommentItem",props:{comment:Object},emits:["response"],setup(p,{emit:m}){const e=p,d=async()=>{J.confirm("确定删除该评论吗？","Warning",{confirmButtonText:"确实",cancelButtonText:"取消",type:"warning"}).then(()=>{j(e.comment.id,b(),u=>{window.location.reload()},u=>{k({title:"删除失败",type:"error",message:u})})}).catch(()=>{K({type:"info",message:"已取消删除"})})},t=async()=>{window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"}),m("response",e.comment.id)};return(u,v)=>{const r=P("CommentItem",!0);return s(),a("div",null,[o("div",oe,[o("h5",se,l(e.comment.userName)+" /@"+l(e.comment.id),1),o("h5",{class:"comentIten-reply",onClick:t},"回复"),o("p",ne,l(e.comment.content),1),C(b)()!=null?(s(),a("h5",{key:0,class:"comentIten-delete",onClick:d},"删除")):y("",!0),o("small",null,l(C(M)(e.comment.createdAt)),1)]),e.comment.comments.length>0?(s(),a("div",ae,[(s(!0),a(V,null,A(e.comment.comments,(n,c)=>(s(),E(r,{onResponse:v[0]||(v[0]=g=>{e.comment.id=g,m("response",e.comment.id)}),key:c,comment:n},null,8,["comment"]))),128))])):y("",!0)])}}},le=$(me,[["__scopeId","data-v-3f334452"]]);const re=p=>(q("data-v-f0bd1887"),p=p(),D(),p),ce={key:0,class:"article-content"},ie={key:0},ue=["innerHTML"],de={key:1,class:"article-content"},pe={key:0},_e=["innerHTML"],ve={key:2},ge={class:"article-contents"},fe=re(()=>o("h2",{class:"article-contents-h2"},"评论区",-1)),ye={__name:"ArticlePage",props:{},emits:["response"],setup(p,{emit:m}){m("response","文章");const e=L(),d=I(e.params.id),t=I({}),u=I(),v=I({articleId:d.value,parentId:""});return O(d.value,r=>{t.value=r.data},r=>{k({title:"获取文章失败",type:"error",message:r})}),W(d.value,r=>{u.value=r.data},r=>{k({title:"获取评论失败",type:"error",message:r})}),(r,n)=>{const c=R("highlight");return s(),a(V,null,[t.value.markdownContent==""?(s(),a("div",ce,[o("p",null," / "+l(C(e).params.id),1),t.value.tags!=""?(s(),a("p",ie,"文章分类："+l(t.value.tags),1)):y("",!0),o("p",null,"更新时间："+l(t.value.updatedAt),1),o("h1",null,l(t.value.title),1),o("div",{innerHTML:t.value.content,class:"markdown-body"},null,8,ue)])):(s(),a("div",de,[o("p",null," / "+l(C(e).params.id),1),t.value.tags!=""?(s(),a("p",pe,"文章分类："+l(t.value.tags),1)):y("",!0),o("p",null,"更新时间："+l(t.value.updatedAt),1),o("h1",null,l(t.value.title),1),S(o("div",{innerHTML:C(Q)(t.value.markdownContent??""),class:"markdown-body"},null,8,_e),[[c]])])),u.value&&u.value.comments?(s(),a("div",ve,[o("div",ge,[fe,(s(!0),a(V,null,A(u.value.comments,(g,f)=>(s(),a("div",{key:f,class:"article-contents-item"},[i(le,{comment:g,onResponse:n[0]||(n[0]=w=>v.value.parentId=w)},null,8,["comment"])]))),128))])])):y("",!0),i(te,{msg:v.value},null,8,["msg"])],64)}}},Ve=$(ye,[["__scopeId","data-v-f0bd1887"]]);export{Ve as default};
