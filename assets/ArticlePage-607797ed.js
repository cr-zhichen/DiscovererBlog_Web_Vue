import{M as P}from"./index-f5b80f59.js";import{a7 as V,G as g,af as C,o as a,g as r,h as o,t as y,k as m,w as f,a8 as x,l as A,X as M,i as k,a9 as T,Z as w,$ as N,j as B,m as $,ag as L,ad as R,ae as S}from"./index-cb44fc4a.js";import{z as F,r as p,A as H,e as q,B as U,C as j,D}from"./PostAPI-0e4799e3.js";import{a as O,E as z}from"./el-form-item-7b1cb3ab.js";import{E as G}from"./el-button-cd815b9a.js";import"./index-7c9df1fa.js";const X={class:"comment-div"},Z={class:"comment-div-h2"},J={__name:"Comment",props:{msg:Object},setup(i){const u=i,e=g({name:"",email:"",comment:""}),c=g(!1),l=async()=>{if(e.value.name===""||e.value.email===""||e.value.comment===""){p({title:"发表评论失败",type:"error",message:"请填写完整信息"});return}H(u.msg.articleId,e.value.name,e.value.email,u.msg.parentId,e.value.comment,C(),t=>{p({title:"发表成功",type:"success",message:t.message}),window.location.reload()},t=>{p({title:"发表评论失败",type:"error",message:t})})};(C()!=null||C()!="")&&F(C(),t=>{e.value.email=t.data.email,e.value.name=t.data.userName,c.value=!0},t=>{});const s=[{required:!0,message:"邮箱不能为空",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],d=[{required:!0,message:"评论不能为空",trigger:"blur"}],b=[{required:!0,message:"昵称不能为空",trigger:"blur"}];return(t,n)=>{const _=q,v=O,h=G,E=z;return a(),r("div",X,[o("h2",Z,"评论"+y(u.msg.parentId),1),m(E,{model:e.value,"label-position":t.left,ref:"commentForm",onSubmit:A(l,["prevent"]),class:"comment-form"},{default:f(()=>[m(v,{label:"昵称：",class:"comment-form-item",prop:"name",rules:b},{default:f(()=>[m(_,{modelValue:e.value.name,"onUpdate:modelValue":n[0]||(n[0]=I=>e.value.name=I),class:"comment-form-item",disabled:c.value},null,8,["modelValue","disabled"])]),_:1}),m(v,{label:"邮箱：",class:"comment-form-item",prop:"email",rules:s},{default:f(()=>[m(_,{modelValue:e.value.email,"onUpdate:modelValue":n[1]||(n[1]=I=>e.value.email=I),class:"comment-form-item",disabled:c.value},null,8,["modelValue","disabled"])]),_:1}),m(v,{label:"评论：",class:"comment-form-item",prop:"comment",rules:d},{default:f(()=>[m(_,{type:"textarea",modelValue:e.value.comment,"onUpdate:modelValue":n[2]||(n[2]=I=>e.value.comment=I),class:"comment-form-item comment-form-textarea"},null,8,["modelValue"])]),_:1}),m(v,{class:"comment-form-item"},{default:f(()=>[m(h,{type:"primary",onClick:l,class:"comment-form-primary"},{default:f(()=>[x("发送评论 ")]),_:1})]),_:1})]),_:1},8,["model","label-position","onSubmit"])])}}},K=V(J,[["__scopeId","data-v-4670ae1b"]]);const Q={class:"comment"},W={class:"comentIten-userName"},Y={class:"comentIten-content"},ee={key:0,class:"replies"},te={__name:"CommentItem",props:{comment:Object},emits:["response"],setup(i,{emit:u}){const e=i,c=async()=>{confirm("确定删除该评论吗？")&&U(e.comment.id,C(),s=>{p({title:"删除成功",type:"success",message:s.message}),window.location.reload()},s=>{p({title:"删除失败",type:"error",message:s})})},l=async()=>{window.scrollTo(0,document.body.scrollHeight),u("response",e.comment.id)};return(s,d)=>{const b=M("CommentItem",!0);return a(),r("div",null,[o("div",Q,[o("h5",W,y(e.comment.userName),1),o("h5",{class:"comentIten-reply",onClick:l},"回复"),o("p",Y,y(e.comment.content),1),o("h5",{class:"comentIten-delete",onClick:c},"删除"),o("small",null,y(k(T)(e.comment.createdAt)),1)]),e.comment.comments.length>0?(a(),r("div",ee,[(a(!0),r(w,null,N(e.comment.comments,(t,n)=>(a(),B(b,{onResponse:d[0]||(d[0]=_=>{e.comment.id=_,u("response",e.comment.id)}),key:n,comment:t},null,8,["comment"]))),128))])):$("",!0)])}}},oe=V(te,[["__scopeId","data-v-f147366f"]]);const se=i=>(R("data-v-c36d7449"),i=i(),S(),i),ne={key:0,class:"article-content"},me=["innerHTML"],ae={key:1,class:"article-content"},le=["innerHTML"],re={key:2},ce=se(()=>o("h2",null,"评论",-1)),ie={class:"article-contents"},ue={__name:"ArticlePage",props:{},emits:["response"],setup(i,{emit:u}){u("response","文章");const e=L(),c=g(e.params.id),l=g({}),s=g(),d=g({articleId:c.value,parentId:""}),b=new P;return j(c.value,t=>{l.value=t.data},t=>{p({title:"获取文章失败",type:"error",message:t})}),D(c.value,t=>{s.value=t.data},t=>{p({title:"获取评论失败",type:"error",message:t})}),(t,n)=>(a(),r(w,null,[x(" / "+y(k(e).params.id)+" ",1),o("h1",null,y(l.value.title),1),l.value.markdownContent==""?(a(),r("div",ne,[o("div",{innerHTML:l.value.content,class:"markdown-body"},null,8,me)])):(a(),r("div",ae,[o("div",{innerHTML:k(b).render(l.value.markdownContent??""),class:"markdown-body"},null,8,le)])),s.value&&s.value.comments?(a(),r("div",re,[ce,o("div",ie,[(a(!0),r(w,null,N(s.value.comments,(_,v)=>(a(),r("div",{key:v,class:"article-contents-item"},[m(oe,{comment:_,onResponse:n[0]||(n[0]=h=>d.value.parentId=h)},null,8,["comment"])]))),128))])])):$("",!0),m(K,{msg:d.value},null,8,["msg"])],64))}},ye=V(ue,[["__scopeId","data-v-c36d7449"]]);export{ye as default};
