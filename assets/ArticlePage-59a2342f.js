import{M as P}from"./index-f5b80f59.js";import{a7 as x,G as f,ac as y,o,g as a,h as l,t as b,k as m,w as g,a8 as N,l as M,X as T,i as h,m as w,a9 as A,Z as V,$,j as L,ad as R,aa as S,ab as B}from"./index-9c0f0c18.js";import{t as F,r as p,v as H,e as q,w as U,x as j,y as D}from"./PostAPI-c4bff520.js";import{a as O,E as G}from"./el-form-item-93e576ed.js";import{E as X}from"./el-button-1a3b36ea.js";import"./index-f355fd9c.js";const Z={class:"comment-div"},z={class:"comment-div-h2"},J={__name:"Comment",props:{msg:Object},setup(i){const u=i,e=f({name:"",email:"",comment:""}),c=f(!1),r=async()=>{if(e.value.name===""||e.value.email===""||e.value.comment===""){p({title:"发表评论失败",type:"error",message:"请填写完整信息"});return}H(u.msg.articleId,e.value.name,e.value.email,u.msg.parentId,e.value.comment,y(),t=>{p({title:"发表成功",type:"success",message:t.message}),window.location.reload()},t=>{p({title:"发表评论失败",type:"error",message:t})})};(y()!=null||y()!="")&&F(y(),t=>{e.value.email=t.data.email,e.value.name=t.data.userName,c.value=!0},t=>{});const s=[{required:!0,message:"邮箱不能为空",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],d=[{required:!0,message:"评论不能为空",trigger:"blur"}],I=[{required:!0,message:"昵称不能为空",trigger:"blur"}];return(t,n)=>{const _=q,v=O,k=X,E=G;return o(),a("div",Z,[l("h2",z,"评论"+b(u.msg.parentId),1),m(E,{model:e.value,"label-position":t.left,ref:"commentForm",onSubmit:M(r,["prevent"]),class:"comment-form"},{default:g(()=>[m(v,{label:"昵称：",class:"comment-form-item",prop:"name",rules:I},{default:g(()=>[m(_,{modelValue:e.value.name,"onUpdate:modelValue":n[0]||(n[0]=C=>e.value.name=C),class:"comment-form-item",disabled:c.value},null,8,["modelValue","disabled"])]),_:1}),m(v,{label:"邮箱：",class:"comment-form-item",prop:"email",rules:s},{default:g(()=>[m(_,{modelValue:e.value.email,"onUpdate:modelValue":n[1]||(n[1]=C=>e.value.email=C),class:"comment-form-item",disabled:c.value},null,8,["modelValue","disabled"])]),_:1}),m(v,{label:"评论：",class:"comment-form-item",prop:"comment",rules:d},{default:g(()=>[m(_,{type:"textarea",modelValue:e.value.comment,"onUpdate:modelValue":n[2]||(n[2]=C=>e.value.comment=C),class:"comment-form-item comment-form-textarea"},null,8,["modelValue"])]),_:1}),m(v,{class:"comment-form-item"},{default:g(()=>[m(k,{type:"primary",onClick:r,class:"comment-form-primary"},{default:g(()=>[N("发送评论 ")]),_:1})]),_:1})]),_:1},8,["model","label-position","onSubmit"])])}}},K=x(J,[["__scopeId","data-v-4670ae1b"]]);const Q={class:"comment"},W={class:"comentIten-userName"},Y={class:"comentIten-content"},ee={key:0,class:"replies"},te={__name:"CommentItem",props:{comment:Object},emits:["response"],setup(i,{emit:u}){const e=i,c=async()=>{confirm("确定删除该评论吗？")&&U(e.comment.id,y(),s=>{p({title:"删除成功",type:"success",message:s.message}),window.location.reload()},s=>{p({title:"删除失败",type:"error",message:s})})},r=async()=>{window.scrollTo(0,document.body.scrollHeight),u("response",e.comment.id)};return(s,d)=>{const I=T("CommentItem",!0);return o(),a("div",null,[l("div",Q,[l("h5",W,b(e.comment.userName),1),l("h5",{class:"comentIten-reply",onClick:r},"回复"),l("p",Y,b(e.comment.content),1),h(y)()!=null?(o(),a("h5",{key:0,class:"comentIten-delete",onClick:c},"删除")):w("",!0),l("small",null,b(h(A)(e.comment.createdAt)),1)]),e.comment.comments.length>0?(o(),a("div",ee,[(o(!0),a(V,null,$(e.comment.comments,(t,n)=>(o(),L(I,{onResponse:d[0]||(d[0]=_=>{e.comment.id=_,u("response",e.comment.id)}),key:n,comment:t},null,8,["comment"]))),128))])):w("",!0)])}}},oe=x(te,[["__scopeId","data-v-ee21c959"]]);const se=i=>(S("data-v-c36d7449"),i=i(),B(),i),ne={key:0,class:"article-content"},me=["innerHTML"],ae={key:1,class:"article-content"},le=["innerHTML"],re={key:2},ce=se(()=>l("h2",null,"评论",-1)),ie={class:"article-contents"},ue={__name:"ArticlePage",props:{},emits:["response"],setup(i,{emit:u}){u("response","文章");const e=R(),c=f(e.params.id),r=f({}),s=f(),d=f({articleId:c.value,parentId:""}),I=new P;return j(c.value,t=>{r.value=t.data},t=>{p({title:"获取文章失败",type:"error",message:t})}),D(c.value,t=>{s.value=t.data},t=>{p({title:"获取评论失败",type:"error",message:t})}),(t,n)=>(o(),a(V,null,[N(" / "+b(h(e).params.id)+" ",1),l("h1",null,b(r.value.title),1),r.value.markdownContent==""?(o(),a("div",ne,[l("div",{innerHTML:r.value.content,class:"markdown-body"},null,8,me)])):(o(),a("div",ae,[l("div",{innerHTML:h(I).render(r.value.markdownContent??""),class:"markdown-body"},null,8,le)])),s.value&&s.value.comments?(o(),a("div",re,[ce,l("div",ie,[(o(!0),a(V,null,$(s.value.comments,(_,v)=>(o(),a("div",{key:v,class:"article-contents-item"},[m(oe,{comment:_,onResponse:n[0]||(n[0]=k=>d.value.parentId=k)},null,8,["comment"])]))),128))])])):w("",!0),m(K,{msg:d.value},null,8,["msg"])],64))}},ye=x(ue,[["__scopeId","data-v-c36d7449"]]);export{ye as default};
