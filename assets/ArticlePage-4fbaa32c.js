import{E as T,a as B,m as P}from"./markdown-css-cae76386.js";import{ak as $,D as I,as as k,o as s,e as a,A as o,am as x,t as l,a5 as y,a1 as i,w as _,f as E,C as M,ar as L,$ as R,g as C,an as S,a3 as V,a4 as A,at as q,a0 as D,x as F,ap as H,aq as U}from"./index-da6cfdb5.js";import{g as j,c as b,p as O,a as W,d as z,e as G,v as J}from"./PostAPI-1e5f8710.js";import{a as K,E as Q}from"./el-form-item-f04b109b.js";import"./focus-trap-30bb6c5e.js";import"./scroll-a31ad561.js";import"./_initCloneObject-c4c15dce.js";const X={class:"comment-div"},Y={class:"comment-div-h2"},Z={key:0},ee={__name:"Comment",props:{msg:Object},setup(p){const m=p,e=I({name:"",email:"",comment:""}),d=I(!1),t=async()=>{if(e.value.name===""||e.value.email===""||e.value.comment===""){b({title:"发表评论失败",type:"error",message:"请填写完整信息"});return}O(m.msg.articleId,e.value.name,e.value.email,m.msg.parentId,e.value.comment,k(),n=>{b({title:"发表成功",type:"success",message:n.message}),window.location.reload()},n=>{b({title:"发表评论失败",type:"error",message:n})})};(k()!=null||k()!="")&&j(k(),n=>{e.value.email=n.data.email,e.value.name=n.data.userName,d.value=!0},n=>{});const u=[{required:!0,message:"邮箱不能为空",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],v=[{required:!0,message:"评论不能为空",trigger:"blur"}],r=[{required:!0,message:"昵称不能为空",trigger:"blur"}];return(n,c)=>{const g=W,f=K,w=L,N=Q;return s(),a("div",X,[o("h2",Y,[x("评论 "),m.msg.parentId!=null&&m.msg.parentId!=""?(s(),a("span",Z," @"+l(m.msg.parentId),1)):y("",!0)]),i(N,{model:e.value,"label-position":n.left,ref:"commentForm",onSubmit:M(t,["prevent"]),class:"comment-form"},{default:_(()=>[i(f,{label:"昵称：",class:"comment-form-item",prop:"name",rules:r},{default:_(()=>[i(g,{modelValue:e.value.name,"onUpdate:modelValue":c[0]||(c[0]=h=>e.value.name=h),class:"comment-form-item",disabled:d.value},null,8,["modelValue","disabled"])]),_:1}),i(f,{label:"邮箱：",class:"comment-form-item",prop:"email",rules:u},{default:_(()=>[i(g,{modelValue:e.value.email,"onUpdate:modelValue":c[1]||(c[1]=h=>e.value.email=h),class:"comment-form-item",disabled:d.value},null,8,["modelValue","disabled"])]),_:1}),i(f,{label:"评论：",class:"comment-form-item",prop:"comment",rules:v},{default:_(()=>[i(g,{type:"textarea",modelValue:e.value.comment,"onUpdate:modelValue":c[2]||(c[2]=h=>e.value.comment=h),class:"comment-form-item comment-form-textarea"},null,8,["modelValue"])]),_:1}),i(f,{class:"comment-form-item"},{default:_(()=>[i(w,{type:"primary",onClick:t,class:"comment-form-primary"},{default:_(()=>[x("发送评论 ")]),_:1})]),_:1}),m.msg.parentId!=null&&m.msg.parentId!=""?(s(),E(f,{key:0,class:"comment-form-item"},{default:_(()=>[i(w,{type:"danger",onClick:c[3]||(c[3]=h=>m.msg.parentId=null),class:"comment-form-cancel"},{default:_(()=>[x(" 取消回复 ")]),_:1})]),_:1})):y("",!0)]),_:1},8,["model","label-position","onSubmit"])])}}},te=$(ee,[["__scopeId","data-v-1317f22f"]]);const oe={class:"comment"},se={class:"comentIten-userName"},ne={class:"comentIten-content"},ae={key:0,class:"replies"},me={__name:"CommentItem",props:{comment:Object},emits:["response"],setup(p,{emit:m}){const e=p,d=async()=>{T.confirm("确定删除该评论吗？","Warning",{confirmButtonText:"确实",cancelButtonText:"取消",type:"warning"}).then(()=>{z(e.comment.id,k(),u=>{window.location.reload()},u=>{b({title:"删除失败",type:"error",message:u})})}).catch(()=>{B({type:"info",message:"已取消删除"})})},t=async()=>{window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"}),m("response",e.comment.id)};return(u,v)=>{const r=R("CommentItem",!0);return s(),a("div",null,[o("div",oe,[o("h5",se,l(e.comment.userName)+" /@"+l(e.comment.id),1),o("h5",{class:"comentIten-reply",onClick:t},"回复"),o("p",ne,l(e.comment.content),1),C(k)()!=null?(s(),a("h5",{key:0,class:"comentIten-delete",onClick:d},"删除")):y("",!0),o("small",null,l(C(S)(e.comment.createdAt)),1)]),e.comment.comments.length>0?(s(),a("div",ae,[(s(!0),a(V,null,A(e.comment.comments,(n,c)=>(s(),E(r,{onResponse:v[0]||(v[0]=g=>{e.comment.id=g,m("response",e.comment.id)}),key:c,comment:n},null,8,["comment"]))),128))])):y("",!0)])}}},le=$(me,[["__scopeId","data-v-3f334452"]]);const re=p=>(H("data-v-ef08673e"),p=p(),U(),p),ce={key:0,class:"article-content"},ie={key:0},ue=["innerHTML"],de={key:1,class:"article-content"},pe={key:0},_e=["innerHTML"],ve={key:2},ge={class:"article-contents"},fe=re(()=>o("h2",{class:"article-contents-h2"},"评论区",-1)),ye={__name:"ArticlePage",props:{},emits:["response"],setup(p,{emit:m}){m("response","文章");const e=q(),d=I(e.params.id),t=I({}),u=I(),v=I({articleId:d.value,parentId:""});return G(d.value,r=>{t.value=r.data},r=>{b({title:"获取文章失败",type:"error",message:r})}),J(d.value,r=>{u.value=r.data},r=>{b({title:"获取评论失败",type:"error",message:r})}),(r,n)=>{const c=D("highlight");return s(),a(V,null,[t.value.markdownContent==""?(s(),a("div",ce,[o("p",null," / "+l(C(e).params.id),1),t.value.tags!=""?(s(),a("p",ie,"文章分类："+l(t.value.tags),1)):y("",!0),o("p",null,"更新时间："+l(t.value.updatedAt),1),o("h1",null,l(t.value.title),1),o("div",{innerHTML:t.value.content,class:"markdown-body"},null,8,ue)])):(s(),a("div",de,[o("p",null," / "+l(C(e).params.id),1),t.value.tags!=""?(s(),a("p",pe,"文章分类："+l(t.value.tags),1)):y("",!0),o("p",null,"更新时间："+l(t.value.updatedAt),1),o("h1",null,l(t.value.title),1),F(o("div",{innerHTML:C(P)(t.value.markdownContent??""),class:"markdown-body"},null,8,_e),[[c]])])),u.value&&u.value.comments?(s(),a("div",ve,[o("div",ge,[fe,(s(!0),a(V,null,A(u.value.comments,(g,f)=>(s(),a("div",{key:f,class:"article-contents-item"},[i(le,{comment:g,onResponse:n[0]||(n[0]=w=>v.value.parentId=w)},null,8,["comment"])]))),128))])])):y("",!0),i(te,{msg:v.value},null,8,["msg"])],64)}}},Ve=$(ye,[["__scopeId","data-v-ef08673e"]]);export{Ve as default};
